#!/usr/bin/env bash
# vim: ft=bash
#
# To run this script via Curl:
#
#    bash -c "$(curl -fsSL https://bit.ly/colorize-mysql)"
#
# Â© 2020 Konstantin Gredeskoul, distributed as part of Bashmatic Framework.
#

[[ -d ~/.bashmatic ]] || bash -c "$(curl -fsSL http://bit.ly/bashmatic-1-1-0)"
source "${HOME}/.bashmatic/init.sh" 1>/dev/null

h1 "This script installs files ~/.my.cnf and ~/.grcat to colorize mysql output."
run.ui.press-any-key "Press Ctrl-C to abort or any key to continue...\n" || {
  abort
  exit 1
}

if [[ ${AppCurrentOS} == "Darwin" ]]; then
  brew.install grc
elif  [[ ${AppCurrentOS} == "Linux" ]]; then
  run "sudo apt-get install grc"
fi

if [[ -z $(command -V grcat) ]]; then
  error "Can't find grcat in the PATH, aborting. Are you on OS-X or Linux? If not, your OS may not be supported."
  exit 1
fi


declare -a FILES=(.my.cnf .grcat)

cat <<EOF > /tmp/${FILES[0]}
[mysql]
pager  = grcat ~/.grcat
EOF

cat <<EOF > /tmp/${FILES[1]}
#default word color
#regexp=[\w.,\:\-_/]+
regexp=.+
colours=green
-

#table borders
regexp=[+\-]+[+\-]|[|]
colours=red
-

#data in ( ) and ' '
regexp=\([\w\d,']+\)
colours=white
-

#numeric
regexp=\s[\d\.]+\s*($|(?=\|))
colours=yellow
-

#date
regexp=\d{4}-\d{2}-\d{2}
colours=cyan
-
#time
regexp=\d{2}:\d{2}:\d{2}
colours=cyan
-

#IP
regexp=(\d{1,3}\.){3}\d{1,3}(:\d{1,5})?
colours=cyan
-

#schema
regexp=\`\w+\`
colours=yellow
-

#email
regexp=[\w\.\-_]+@[\w\.\-_]+
colours=magenta
-

#row delimeter when using \G key
regexp=[*]+.+[*]+
count=stop
colours=white
-

#column names when using \G key
regexp=^\s*\w+:
colours=white
EOF

for file in ${FILES[@]}; do
  file.install-with-backup "/tmp/${file}" "${HOME}/${file}"
done





